/*
 * pedestrian.c
 *
 *  Created on: Dec 6, 2022
 *      Author: ADMIN
 */

#include "pedestrian.h"

void fsm_pedestrian() {
	switch (status4) {
	case PEDESTRIAN_RUN_ALLOW:
		HAL_GPIO_WritePin(L2_EN0_GPIO_Port, L2_EN0_Pin, RESET);
		HAL_GPIO_WritePin(L2_EN1_GPIO_Port, L2_EN1_Pin, SET);
		if (isTimer5Expired()) {
			status4 = PEDESTRIAN_OFF;
			clearTimer5();
		}
		if(timeCountdown1 <= 5){
			__HAL_TIM_SetCompare(&htim3,TIM_CHANNEL_1,timeCountdown1*20);
		}
		if(status1 == AUTO_GREEN || status1 == AUTO_YELLOW){
			status4 = PEDESTRIAN_RUN_NOT_ALLOW;
			__HAL_TIM_SetCompare(&htim3,TIM_CHANNEL_1,0);
		}
		break;
	case PEDESTRIAN_RUN_NOT_ALLOW:
		HAL_GPIO_WritePin(L2_EN0_GPIO_Port, L2_EN0_Pin, SET);
		HAL_GPIO_WritePin(L2_EN1_GPIO_Port, L2_EN1_Pin, RESET);
		if (isTimer5Expired()) {
			status4 = PEDESTRIAN_OFF;
			clearTimer5();
		}
		if(status1 == AUTO_RED){
			status4 = PEDESTRIAN_RUN_ALLOW;
		}
		break;
	case PEDESTRIAN_OFF:
		HAL_GPIO_WritePin(L2_EN0_GPIO_Port, L2_EN0_Pin, RESET);
		HAL_GPIO_WritePin(L2_EN1_GPIO_Port, L2_EN1_Pin, RESET);
		break;
	}
}
